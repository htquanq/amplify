version: 1.0
frontend:
  phases:
    preBuild:
      commands:
        - sudo yum update -y
        - sudo yum groupinstall -y "Development Tools" 
        - sudo yum install -y expat-devel gtk-doc libpng-devel glib2-devel libjpeg-devel zlib-devel
        - wget https://github.com/libvips/libvips/releases/download/v8.12.2/vips-8.12.2.tar.gz
        - tar -xzvf vips-8.12.2.tar.gz
        - cd vips-8.12.2
        - sudo ./configure
        - sudo make
        - sudo make install
        - cd ..
        - nvm install 20.15.0
        - nvm use 20.15.0
        - corepack enable pnpm
        - corepack use pnpm@9.1.1
        - pnpm i --frozen-lockfile
    build:
      commands:
        - nvm install 20.15.0
        - nvm use 20.15.0
        - corepack enable pnpm
        - corepack use pnpm@9.1.1
        - pnpm run build
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
